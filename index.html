<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>: Dependency Management with Gradle</title><meta content="yes" name="apple-mobile-web-app-capable" /><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport" /><link href="reveal.js/css/reveal.css" rel="stylesheet" /><link rel="stylesheet" href="reveal.js/css/theme/gradle.css" id="theme" /><!--This CSS is generated by the Asciidoctor-Reveal.js converter to further integrate AsciiDoc's existing semantic with Reveal.js--><style type="text/css">.reveal div.right {
  float: right;
}

/* callouts */
.conum[data-value] {display:inline-block;color:#fff!important;background-color:rgba(50,150,50,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" /><link href="reveal.js/lib/css/zenburn.css" rel="stylesheet" /><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "reveal.js/css/print/pdf.css" : "reveal.js/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><!--[if lt IE 9]><script src="reveal.js/lib/js/html5shiv.js"></script><![endif]-->
<link rel="stylesheet" type="text/css" href="reveal.js/css/theme/asciinema-player.css" />
<link rel="stylesheet" type="text/css" href="reveal.js/css/theme/asciinema-theme-gradle.css" />
<link rel="stylesheet" type="text/css" href="reveal.js/css/theme/highlight-theme.css" />
<script src="reveal.js/css/theme/asciinema-player.js"></script></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title" data-transition="zoom" data-transition-speed="fast" data-background-image="./images/title.png"><h1></h1><h2>Dependency Management with Gradle</h2><div class="preamble"><div class="paragraph"><p><h3>
Part 2 - Handling Conflicts and Customizing Resolution
</h3></p></div>
<div class="paragraph"><p>Cédric Champeau (@CedricChampeau) &amp; Louis Jacomet (@ljacomet) - Gradle Inc.</p></div></div></section>
<section id="who-are-we"><h2>Who are we?</h2><div class="imageblock" style=""><img src="./images/who-s-who.png" alt="who s who" width="520" height="250" /></div>
<div class="paragraph"><p>Dependency management team</p></div></section>
<section><section id="declaring-and-analyzing-dependencies-in-gradle" data-background-color="#01303a"><h2>Declaring and Analyzing Dependencies in Gradle</h2><div class="paragraph"><p>Including a quick recap of</p></div><div class="paragraph"><p><a href="https://gradle.com/blog/dependency-management-fundamentals">Dependency Management with Gradle Part 1 – Fundamentals</a></p></div></section><section id="gradle-build-tool"><h2>Gradle Build Tool</h2><div class="paragraph"><p>Build and automation tool with rich <em>dependency management</em> functionality</p></div>
<div class="ulist"><ul><li><p>JVM based and implemented in Java</p></li><li><p>100% Free Open Source - Apache Standard License 2.0</p></li><li><p>Agnostic build tool (Java, Groovy, Kotlin, Scala, Android, C, C++, Swift, &#8230;&#8203;)</p></li></ul></div>
<pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">plugins {
    `java-library`
}
repositories {
    mavenCentral()
}
dependencies {
    implementation("org.slf4j:slf4j-api:1.7.2")
}</code></pre></section><section id="build-scans-and-gradle-enterprise"><h2>Build Scans and Gradle Enterprise</h2><div class="ulist"><ul><li><p>Run build with <code>--scan</code> to create a private scan on <a href="https://scans.gradle.com">scans.gradle.com</a></p></li><li><p><a href="https://gradle.com">Gradle Enterprise</a> (commercial product) can be installed on premises</p></li></ul></div>
<div class="imageblock" style=""><img src="./images/scans/scan-general.png" alt="scan general" width="100%" height="100%" /></div></section><section id="modules-live-in-repositories"><h2>Modules live in Repositories</h2><div class="ulist"><ul><li><p>Identified by <em>group</em>, <em>name</em> and <em>version</em> (e.g. <code>org.slf4j:slf4j-api:1.7.2</code>)</p></li><li><p>Consists of artifacts  (e.g. <code>.jar</code>) and metadata (<a href="https://blog.gradle.org/gradle-metadata-1.0"><code>.module</code></a>, <code>.pom</code> or <code>ivy.xml</code>)</p></li><li><p>Repositories are visited sequentially</p></li></ul></div></section><section id="inspecting-dependencies"><h2>Inspecting dependencies</h2><div class="paragraph"><p>By default transitive dependencies are brought in</p></div>
<pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">dependencies {
    implementation("org.apache.httpcomponents:httpclient:4.5.9")
}</code></pre>
<div class="paragraph"><p>Show dependency graph:</p></div>
<div class="paragraph"><p><code>gradle dependencies --configuration compileClasspath</code></p></div>
<pre class="highlight listingblock"><code data-noescape="" class="yaml language-yaml">compileClasspath - Compile classpath for source set 'main'.
\--- org.apache.httpcomponents:httpclient:4.5.9
     +--- org.apache.httpcomponents:httpcore:4.4.11
     +--- commons-logging:commons-logging:1.2
     \--- commons-codec:commons-codec:1.11</code></pre></section><section id="focusing-on-a-dependency"><h2>Focusing on a dependency</h2><div class="paragraph"><p>Show path to a dependency:</p></div>
<pre class="highlight listingblock"><code data-noescape="" class="bash language-bash">gradle dependencyInsight
             --configuration compileClasspath
             --dependency codec</code></pre>
<div class="paragraph"><p>Result:</p></div>
<pre class="highlight listingblock"><code data-noescape="" class="yaml language-yaml">...
commons-codec:commons-codec:1.11
\--- org.apache.httpcomponents:httpclient:4.5.9
     \--- compileClasspath
...</code></pre></section><section id="inspect-dependencies-in-build-scan"><h2>Inspect dependencies in build scan</h2><div class="paragraph"><p><a href="https://scans.gradle.com">scans.gradle.com</a> (<code>--scan</code>) or <em>Gradle Enterprise</em> provide a dependency inspector</p></div>
<div class="imageblock" style=""><img src="./images/scans/scan-httpclient.png" alt="scan httpclient" width="100%" height="100%" /></div></section><section id="dependency-constraints"><h2>Dependency constraints</h2><div class="ulist"><ul><li><p>Introduce additional constraints on versions</p></li><li><p><strong>Does not</strong> override versions of transitive dependencies</p></li></ul></div>
<pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">dependencies {
    constraints {
        implementation("org.slf4j:slf4j-api:1.7.26")
        implementation("org.apache:commons-lang3:3.3.0")
    }
    dependencies {
        implementation("org.slf4j:slf4j-api") // no version
    }
}</code></pre></section><section id="rich-dependency-versions"><h2>Rich dependency versions</h2><div class="ulist"><ul><li><p>Work also with dependency constraints</p></li><li><p><strong>Does not</strong> override versions of transitive dependencies</p></li></ul></div>
<pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">dependencies {
   implementation("info.picocli:picocli") {
       version {
          strictly("[3.9, 4.0[")
          prefer("3.9.5")
       }
       because("Provides command-line argument parsing")
   }
}</code></pre></section><section id="platforms-to-share-versions"><h2>Platforms to share versions</h2><div class="title">platform/build.gradle.kts</div><pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">plugins {
   `java-platform`
}

dependencies {
    constraints {
       api("org.slf4j:slf4j-api:1.7.26")
       runtime("org.slf4j:slf4j-simple:1.7.26")
    }
}</code></pre>
<div class="title">cli/build.gradle.kts</div><pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">dependencies {
   api(platform(project(":platform")))

   implementation("org.slf4j:slf4j-api") // &lt;-- no version here
}</code></pre></section><section id="semantics-and-dependencies"><h2>Semantics and dependencies</h2><div class="paragraph"><p>Gradle has a strong modelling of dependencies:</p></div>
<div class="ulist"><ul><li><p>Semantic difference between compilation and runtime</p></li><li><p>Semantic difference between building a library and building <em>against</em> a library</p></li><li><p>Ability for a module to produce more than one variant</p></li></ul></div></section></section>
<section><section id="understanding-conflict-resolution" data-background-color="#01303a"><h2>Understanding conflict resolution</h2></section><section id="different-kinds-of-conflicts"><h2>Different kinds of conflicts</h2><div class="ulist"><ul><li><p>Version conflicts</p><div class="ulist"><ul><li><p>2 or more dependencies want a different version of the same thing</p></li></ul></div></li><li><p>Implementation conflicts</p><div class="ulist"><ul><li><p>there are more than one implementation of the same thing</p></li></ul></div></li></ul></div></section><section id="definition-of-version-conflict"><h2>Definition of version conflict</h2><div class="paragraph"><p>There&#8217;s a <em>version</em> conflict whenever two components:</p></div>
<div class="ulist"><ul><li><p>depend on the same module D</p></li><li><p>depend on different versions of module D</p></li></ul></div>
<div class="paragraph"><p>For example:</p></div>
<div class="ulist"><ul><li><p>A &#8594; D:1.0</p></li><li><p>B &#8594; D:1.1</p></li></ul></div></section><section id="maven-vs-gradle"><h2>Maven vs Gradle</h2><div class="imageblock" style=""><img src="./images/asciidoctor-diagram-conflict1.png" alt="asciidoctor diagram conflict1" width="1280" height="20%" /></div>
<div class="ulist"><ul><li><p>Maven selects version <strong>20.0</strong></p></li><li><p>Gradle selects version <strong>25.1-android</strong></p></li></ul></div>
<div class="paragraph"><p>Why?</p></div></section><section id="maven-s-nearest-first"><h2>Maven&#8217;s Nearest first</h2><div class="ulist"><ul><li><p>"Nearest" dependency version wins</p></li><li><p><code>root</code> &#8594; <code>guava:20.0</code> which is <em>closer</em> than <code>root</code> &#8594; <code>guice</code> &#8594; <code>guava:25.1-android</code></p></li><li><p>So <code>20.0</code> <em>wins</em></p></li></ul></div></section><section id="problems-with-nearest-first"><h2>Problems with nearest first</h2></section><section id="nearest-is-order-dependent"><h2>Nearest is order dependent!</h2><div class="imageblock" style=""><img src="./images/asciidoctor-diagram-maven1.png" alt="asciidoctor diagram maven1" width="1280" height="30%" /></div>
<div class="paragraph"><p>Selects <code>guava:25.1-android</code></p></div></section><section id="nearest-is-order-dependent-2"><h2>Nearest is order dependent!</h2><div class="imageblock" style=""><img src="./images/asciidoctor-diagram-maven2.png" alt="asciidoctor diagram maven2" width="1280" height="30%" /></div>
<div class="paragraph"><p>Selects <code>guava:20</code></p></div>
<div class="paragraph"><p><strong>Nearest first is basically unpredictable for any reasonably sized dependency graph</strong></p></div></section><section id="typical-maven-workarounds"><h2>Typical Maven workarounds</h2><div class="ulist"><ul><li><p>Adding <code>exclusions</code> + first level dependency</p><div class="ulist"><ul><li><p>leaks dependencies</p></li></ul></div></li><li><p>Adding a <code>dependencyManagement</code> block</p><div class="ulist"><ul><li><p>but non transitive!</p></li></ul></div></li></ul></div></section><section id="how-gradle-works"><h2>How Gradle works</h2><div class="ulist"><ul><li><p>Performs <em>full conflict resolution</em></p></li><li><p>All opinions matter</p></li><li><p><em>Highest wins</em>: we always choose 25.1-android whatever the order</p></li></ul></div></section><section id="gradle-dependency-constraints"><h2>Gradle dependency constraints</h2><pre class="highlight listingblock"><code data-noescape="">dependencies {
   constraints {
      implementation("com.google.guava:guava:guava:25.1-android")
   }
}</code></pre>
<div class="paragraph"><p>are honored <em>transitively</em></p></div></section><section id="ivy-conflict-resolution"><h2>Ivy conflict resolution</h2><div class="ulist"><ul><li><p>Ivy uses <em>pluggable</em> conflict resolvers</p></li><li><p>can be different <em>per dependency</em></p></li><li><p>hard to reason about</p></li></ul></div></section></section>
<section><section id="handling-conflict-resolution-in-gradle" data-background-color="#01303a"><h2>Handling conflict resolution in Gradle</h2></section><section id="failing-on-version-conflict"><h2>Failing on version conflict</h2><pre class="highlight listingblock"><code data-noescape="">configurations {
   compileClasspath {
       resolutionStrategy.failOnVersionConflict()
   }
}</code></pre>
<div class="ulist"><ul><li><p>Forces you to <em>think</em> about conflicts</p></li><li><p>Requires an explicit way to select a version</p></li></ul></div></section><section id="dependency-resolution-rules"><h2>Dependency resolution rules</h2><div class="ulist"><ul><li><p>Offer <em>one</em> way to solve conflicts</p></li><li><p>Limited to the <em>configuration being resolved</em></p></li></ul></div>
<pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">configurations.all {
    resolutionStrategy.eachDependency {
        if (requested.group == "org.apache.commons" &amp;&amp;
            requested.name == "commons-lang3") {
            useVersion("3.3.1")
            because("tested with this version")
        }
    }
}</code></pre></section><section id="demo" data-background-color="#01303a"><h2>Demo</h2></section><section id="when-metadata-is-wrong"><h2>When metadata is wrong</h2><div class="ulist"><ul><li><p>Sometimes metadata of a module is simply <em>wrong</em></p><div class="ulist"><ul><li><p>"hard" dependency when it should be optional</p></li><li><p>dependency on broken version</p></li><li><p>missing dependencies</p></li><li><p>&#8230;&#8203;</p></li></ul></div></li></ul></div></section><section id="component-metadata-rules"><h2>Component metadata rules</h2><div class="ulist"><ul><li><p>Allow fixing metadata</p></li><li><p>Applied to <em>all configurations</em> (unconditionally true)</p></li></ul></div></section><section id="e-g-a-href-https-issues-apache-org-jira-browse-camel-9300-deltaspike-container-control-dependency-in-camel-cdi-should-be-optional-a"><h2>e.g: <a href="https://issues.apache.org/jira/browse/CAMEL-9300">DeltaSpike container control dependency in Camel CDI should be optional</a></h2><pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">fun DependencyHandler.fixBadMetadata() = components {
    withModule("org.apache.camel:camel-cdi", FixApacheCamel::class.java)
}

class FixApacheCamel: ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) = context.details.run {
        if (id.version.startsWith("2.15")) {
            allVariants {
                withDependencies {
                    removeAll { it.group.contains("deltaspike") }
                }
            }
        }
    }
}</code></pre></section><section id="handling-mutually-exclusive-modules"><h2>Handling mutually exclusive modules</h2><div class="ulist"><ul><li><p>A <em>capability</em> describes a feature that is mutually exclusive</p></li><li><p>All components provide their GAV as a capability by default</p></li></ul></div></section><section id="the-famous-logging-problem"><h2>The famous logging problem</h2><div class="ulist"><ul><li><p>Slf4j and is bridging / replacement modules</p></li><li><p><code>log4j</code> vs. <code>slf4j-log4j12</code> vs. <code>log4j-over-slf4j</code></p></li><li><p>And similarly for <code>java.util.logging</code></p></li><li><p>And again for <code>commons-logging</code></p></li></ul></div></section><section id="relocated-libraries"><h2>Relocated libraries</h2><div class="ulist"><ul><li><p><code>asm:asm</code> now known as <code>org.ow2.asm:asm</code></p></li><li><p><code>junit:junit-dep</code> and <code>junit:junit</code></p></li><li><p><code>cglib:cglib-nodep</code> and <code>cglib:cglib</code></p></li></ul></div></section><section id="detecting-conflicts"><h2>Detecting conflicts</h2><pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">fun DependencyHandler.detectLoggerConflicts() = components {
    // both commons-logging and jcl-over-slf4j implement the commons-logging api
    withModule("org.slf4j:jcl-over-slf4j", CommonLoggingCapabilities::class.java)
    withModule("org.apache.commons:commons-logging", CommonLoggingCapabilities::class.java)

    // both slf4j-simple and slf4j-log4j12 implement the slf4j api
    withModule("org.slf4j:slf4j-simple", Slf4jImplementationCapabilities::class.java)
    withModule("org.slf4j:slf4j-log4j12", Slf4jImplementationCapabilities::class.java)

    // ...</code></pre></section><section id="detecting-conflicts-2"><h2>Detecting conflicts</h2><pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">class CommonLoggingCapabilities : ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) = context.run {
        details.allVariants {
            withCapabilities {
                addCapability("org.apache.commons", "commons-logging-impl", "1.0")
            }
        }
    }

}

class Slf4jImplementationCapabilities : ComponentMetadataRule {
    override fun execute(context: ComponentMetadataContext) = context.run {
        details.allVariants {
            withCapabilities {
                addCapability("org.slf4j", "slf4j-impl", "1.0")
            }
        }
    }
}</code></pre></section><section id="selecting-a-module-over-another-one"><h2>Selecting a module over another one</h2><div class="ulist"><ul><li><p>Uses <em>dependency substitution</em></p></li><li><p>This effectively <em>replaces</em> one module with another</p></li></ul></div>
<pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">fun Configuration.preferSlf4JSimple() = resolutionStrategy.dependencySubstitution {
    substitute(module("org.slf4j:slf4j-log4j12"))
            .because("prefer slf4j-simple over other implementations")
            .with(moduleInGraph("org.slf4j:slf4j-simple"))

    substitute(module("log4j:log4j"))
            .because("use the slf4j bridge for log4j")
            .with(module("org.slf4j:log4j-over-slf4j:1.7.16"))
}

fun Configuration.useSlf4jEverywhere() = resolutionStrategy.eachDependency {
    if (requested.name == "commons-logging") {
        useTarget("org.slf4j:jcl-over-slf4j:0")
    }
}</code></pre></section></section>
<section><section id="excluding-dependencies" data-background-color="#01303a"><h2>Excluding dependencies</h2></section><section id="what-is-it"><h2>What is it?</h2><div class="ulist"><ul><li><p>An option for consumers to prune transitive sections of the graph</p></li><li><p>Maven and Gradle have different handling of exclusions</p></li></ul></div></section><section id="maven-code-exclusion-code"><h2>Maven <code>exclusion</code></h2><div class="ulist"><ul><li><p>With Maven if a dependency is excluded on a given <em>edge</em>, it is excluded for the whole graph</p></li></ul></div>
<div class="imageblock" style=""><img src="./images/asciidoctor-diagram-process3.png" alt="asciidoctor diagram process3" width="1280" height="80%" /></div>
<div class="paragraph"><p><code>C</code> is excluded in Maven</p></div></section><section id="gradle-code-exclude-code"><h2>Gradle <code>exclude</code></h2><div class="ulist"><ul><li><p>With Gradle <em>all paths</em> need to exclude for a dependency to be excluded</p></li></ul></div>
<div class="imageblock" style=""><img src="./images/asciidoctor-diagram-process4.png" alt="asciidoctor diagram process4" width="1280" height="80%" /></div>
<div class="paragraph"><p><code>C</code> is excluded</p></div></section><section id="configuration-level-code-exclude-code"><h2>Configuration level <code>exclude</code></h2><div class="ulist"><ul><li><p>A dependency is <em>many times</em> and <em>deep</em> into the dependency graph and you don&#8217;t need it</p></li><li><p>Exclude it on <em>all paths</em></p></li></ul></div>
<pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">configurations.all {
   exclude group:'commons-logging', module:'commons-logging'
}</code></pre>
<div class="paragraph"><p>However:</p></div>
<div class="ulist"><ul><li><p>Leaks to downstream consumers</p></li><li><p>Even worse: added to <em>all</em> first level dependencies at publication</p></li></ul></div></section><section id="when-to-use-excludes-last-resort"><h2>When to use excludes: last resort</h2><div class="ulist"><ul><li><p>Semantics should be: "I don&#8217;t use this library that this module says it needs"</p></li><li><p>Should be limited to cases where the module <em>actually needs it</em> but your execution paths don&#8217;t</p></li></ul></div>
<pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">    implementation("org.apache.spark:spark-core_2.12:2.4.3") {
        withoutFeatureWhichRequires("org.apache.ivy", "ivy")
    }

// ...

fun ModuleDependency.withoutFeatureWhichRequires(group: String, module: String) {
    exclude(mapOf("group" to group, "module" to module))
    because("we don't use the features of ${name} which require ${group}:${module}")
}</code></pre></section><section id="a-word-about-code-forcing-code"><h2>A word about <code>forcing</code></h2><div class="ulist"><ul><li><p>Forcing dependencies is <em>not recommended</em></p></li><li><p>Behavior can be non reproducible (ordering issues in case of competing forces)</p></li><li><p>Use it <em>only</em> if you don&#8217;t have consumers</p></li><li><p>But prefer <em>resolution rules</em></p></li></ul></div></section><section id="disabling-transitive-resolution"><h2>Disabling transitive resolution</h2><div class="ulist"><ul><li><p>Sometimes you don&#8217;t care about transitivity</p></li><li><p>e.g: download a set of files</p></li></ul></div>
<pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">configurations {
   myFiles {
      transitive = false
   }
}

// ...

tasks {
   downloadFiles {
      from configurations["myFiles"]
   }
}</code></pre></section></section>
<section><section id="transitive-version-conflict-and-consequences" data-background-color="#01303a"><h2>Transitive version conflict and consequences</h2></section><section id="understanding-the-consequences-of-decisions"><h2>Understanding the consequences of decisions</h2><div class="ulist"><ul><li><p>2 categories of consumers</p><div class="ulist"><ul><li><p>libraries: can be <em>consumed</em>, including transitively</p></li><li><p>applications: at the end of the chain</p></li></ul></div></li></ul></div></section><section id="understanding-the-consequences-of-decisions-2"><h2>Understanding the consequences of decisions</h2><div class="ulist"><ul><li><p>Wrong decisions on libraries affect the whole chain</p><div class="ulist"><ul><li><p>e.g: excluding a dependency</p></li><li><p>e.g: forcing a version</p></li><li><p>e.g: adding a constraint</p></li><li><p>e.g: using ranges</p></li></ul></div></li></ul></div></section></section>
<section><section id="improving-graph-consistency" data-background-color="#01303a"><h2>Improving graph consistency</h2></section><section id="the-challenge"><h2>The challenge?</h2><div class="ulist"><ul><li><p>Dependencies do not work in isolation</p><div class="ulist"><ul><li><p>Most projects will use more than a couple</p></li><li><p>Having a consistent set of dependencies is a different problem than having the <em>right</em> dependency at the <em>right</em> version</p></li></ul></div></li><li><p>Organizations may want to</p><div class="ulist"><ul><li><p>Share information on recommended dependencies, including versions and rejections</p></li><li><p>Control available dependencies and their origin</p></li></ul></div></li></ul></div></section><section id="multiple-options-available"><h2>Multiple options available</h2><div class="ulist"><ul><li><p>Repository content filtering</p></li><li><p>Bill Of Materials (BOM) / Recommendation platforms</p></li><li><p>Alignment of library modules</p></li><li><p>and more</p></li></ul></div></section></section>
<section><section id="repository-content-filtering" data-background-color="#01303a"><h2>Repository content filtering</h2></section><section id="modules-live-in-repositories-2"><h2>Modules live in repositories</h2><div class="ulist"><ul><li><p>Identified by <em>group</em>, <em>name</em> and <em>version</em> (e.g. <code>org.slf4j:slf4j-api:1.7.2</code>)</p></li><li><p>Consists of artifacts  (e.g. <code>.jar</code>) and metadata (<a href="https://blog.gradle.org/gradle-metadata-1.0"><code>.module</code></a>, <code>.pom</code> or <code>ivy.xml</code>)</p></li><li><p>Repositories are visited sequentially</p></li></ul></div></section><section id="content-filtering"><h2>Content filtering</h2><div class="ulist"><ul><li><p>Gives control to where dependencies can be sourced from</p></li><li><p>Improves the reproducibility aspect</p></li><li><p>Has security implications as well</p></li></ul></div>
<pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">repositories {
    maven {
        url = 'https://repo.company.com/'
        content {
            includeGroupByRegex​ "my\\.company.*"
        }
    }
    jcenter() {
         content {
             excludeGroup "org.slf4j"
             excludeGroupByRegex​ "my\\.company.*"
         }
    }
}</code></pre></section></section>
<section><section id="bill-of-materials-support-in-gradle" data-background-color="#01303a"><h2>Bill Of Materials support in Gradle</h2></section><section id="what-is-a-maven-bom"><h2>What is a Maven BOM?</h2><div class="ulist"><ul><li><p>Defines versions for dependencies (and more)</p></li><li><p>Used for obtaining a consistent set of versions</p><div class="ulist"><ul><li><p>For modules composing a library, that work better together at the same version</p></li><li><p>For heterogeneous modules that form an ecosystem</p></li></ul></div></li><li><p>Allows to omit versions in the build file that imports it</p></li></ul></div>
<div class="paragraph"><p><a href="http://repo.maven.apache.org/maven2/org/springframework/boot/spring-boot-dependencies/2.1.6.RELEASE/spring-boot-dependencies-2.1.6.RELEASE.pom">Example</a></p></div></section><section id="importing-a-bom-in-gradle"><h2>Importing a BOM in Gradle</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">dependencies {
    implementation(
        platform(
            'org.springframework.boot:spring-boot-dependencies:2.1.6.RELEASE'
        )
    )
}</code></pre></section><section id="particularities-in-gradle"><h2>Particularities in Gradle</h2><div class="ulist"><ul><li><p>BOM dependency declarations are imported as <em>constraints</em></p></li><li><p>BOMs are like regular dependencies, they can be visible by consumers</p><div class="ulist"><ul><li><p>When declared in <code>api</code> for example</p></li></ul></div></li><li><p>Gradle <em>always</em> considers <em>all</em> versions in a dependency graph</p></li></ul></div>
<div class="paragraph"><p>This creates an important difference with application of BOMs in Maven:</p></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content"><em>In Gradle, the transitive dependency graph can still resolve a dependency with a different version than specified in the BOM.</em></td></tr></table></div></section><section id="enforced-boms"><h2>Enforced BOMs</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">dependencies {
    implementation(
        enforcedPlatform(
            'org.springframework.boot:spring-boot-dependencies:2.1.6.RELEASE'
        )
    )
}</code></pre>
<div class="paragraph"><p>Will result in constraints that <em>force</em> versions instead of participating in version conflict resolution.</p></div>
<div class="paragraph"><p>If you have consumers, you should not use this.</p></div></section><section id="replacement-of-spring-dependency-management-plugin"><h2>Replacement of Spring dependency management plugin</h2><div class="ulist"><ul><li><p>✅ for most use cases</p></li><li><p>Unsupported scenarios:</p><div class="ulist"><ul><li><p>If you want to override properties defined in the BOM to have a different set of constraints</p></li><li><p>Local dependency declaration causing a downgrade</p></li></ul></div></li></ul></div></section><section id="recommendation-platforms-in-gradle"><h2>Recommendation platforms in Gradle</h2><div class="ulist"><ul><li><p>By using the <code>java-platform</code> plugin</p></li><li><p>Full feature set requires Gradle Module Metadata publication</p></li><li><p>Will translate to a Maven BOM for the most part</p><div class="ulist"><ul><li><p>⚠️ In Maven order matters, so order in your Gradle build file matters if you need the compatibility</p></li></ul></div></li></ul></div></section><section id="recommendation-platform-example"><h2>Recommendation platform example</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">plugins {
  `java-platform`
}

javaPlatform {
    allowDependencies()
}

dependencies {
  constraints {
      runtime('org.postgresql:postgresql:42.2.6')
  }
  api(platform('com.fasterxml.jackson:jackson-bom:2.9.9'))
  api(platform('org.springframework.boot:spring-boot-dependencies:2.1.5.RELEASE'))
}</code></pre></section></section>
<section><section id="aligning-a-group-of-dependencies" data-background-color="#01303a"><h2>Aligning a group of dependencies</h2></section><section id="what-is-the-problem"><h2>What is the problem?</h2><div class="ulist"><ul><li><p>A group of dependencies are designed to work together.</p><div class="ulist"><ul><li><p>Think <code>jackson</code> or even the Spring framework</p></li></ul></div></li><li><p>Through transitive dependency updates, modules end up having different versions</p></li></ul></div>
<div class="paragraph"><p>So the goal would be to have the tools to make sure that <em>any</em> upgrade of <em>any</em> module would cause the whole set to upgrade its version.</p></div></section><section id="demo-2" data-background-color="#01303a"><h2>Demo</h2></section><section id="virtual-platforms-for-published-libraries"><h2>Virtual platforms for published libraries</h2><div class="olist arabic"><ol class="arabic"><li><p>Name a virtual platform module</p></li><li><p>Enhance library modules metadata to declare they <code>belongsTo</code> the platform</p></li><li><p>The platform collects the modules that belongs to it</p><div class="ulist"><ul><li><p>When <code>jackson-dataformat-yaml</code> says it belongs to the platform, <em>all platform versions</em> now point to it as well</p></li></ul></div></li><li><p>Alignment!</p></li></ol></div></section><section id="usability-details"><h2>Usability details</h2><div class="ulist"><ul><li><p>A virtual platform can only align to a version it sees in the graph</p></li><li><p>A virtual platform will <em>attempt</em> alignment on all modules</p></li></ul></div></section><section id="attempted-alignment-example"><h2>Attempted alignment example</h2><div class="ulist"><ul><li><p><code>com.fasterxml.jackson.core:jackson-databind:2.8.8.1</code> ✅</p></li><li><p><code>com.fasterxml.jackson.core:jackson-core:2.8.8.1</code> ❌</p></li><li><p>The platform will align modules existing in <code>2.8.8.1</code> to that version,</p></li><li><p>Other modules will have the highest <em>lower</em> version that exists for them</p><div class="ulist"><ul><li><p>Saw <code>2.8.8.1</code>, <code>2.8.8</code>, &#8230;&#8203; then others most likely in <code>2.8.8</code></p></li><li><p>Saw <code>2.8.8.1</code>, <code>2.7.8</code>, &#8230;&#8203; then others mostl likely in <code>2.7.8</code></p></li></ul></div></li></ul></div></section><section id="can-i-leverage-an-existing-bom"><h2>Can I leverage an existing BOM?</h2><div class="ulist"><ul><li><p>Yes, <em>but</em></p><div class="ulist"><ul><li><p>You still need the <code>belongsTo</code></p></li><li><p>Alignment will be according to the BOM definitions</p></li></ul></div></li></ul></div></section><section id="using-a-gradle-platform-for-alignment"><h2>Using a Gradle platform for alignment</h2><div class="ulist"><ul><li><p>Leverages the ability to declare the cycle in Gradle</p></li><li><p>A platform depends on all the modules</p></li><li><p>Each modules depends on the platform</p></li><li><p>Requires Gradle Module Metadata to be fully functional</p></li></ul></div></section><section id="alignment-platform"><h2>Alignment platform</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">plugins {
  `java-platform`
}

dependencies {
    constraints {
        api(project(':common'))
        api(project(':server'))
        api(project(':client'))
    }
}</code></pre>
<div class="paragraph"><p>For the projects:</p></div>
<pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">dependencies {
    api(project(':platform'))
}</code></pre></section></section>
<section><section id="conclusion" data-background-color="#01303a"><h2>Conclusion</h2></section><section id="tools-for-a-complex-world"><h2>Tools for a complex world</h2><div class="ulist"><ul><li><p>Real world projects <em>will</em> face dependency conflicts</p></li><li><p>Gradle provides tools to <em>model</em> conflicts</p><div class="ulist"><ul><li><p>not all conflicts are equal (version, implementation, &#8230;&#8203;)</p></li><li><p>better modeling &#8594; better decisions</p></li></ul></div></li><li><p>Sometimes a <em>hammer</em> is an acceptable solution</p></li></ul></div>
<div class="paragraph"><p>We&#8217;re adding tooling to cover more cases!</p></div></section><section id="coming-next"><h2>Coming next</h2><div class="paragraph"><p>Focus on publishing and the importance of Gradle Module Metadata</p></div>
<div class="ulist"><ul><li><p>Publishing components</p></li><li><p>Maven and Ivy compatibility</p></li><li><p>Published capabilities</p></li><li><p>Published alignment</p></li><li><p>Feature variants</p></li><li><p>Test fixtures</p></li></ul></div></section></section>
<section id="thank-you" data-background-image="./images/thank-you.png" data-background-size="cover"></section></div></div><script src="reveal.js/lib/js/head.min.js"></script><script src="reveal.js/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
})

// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: 'true',
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'linear',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
      { src: 'reveal.js/plugin/notes/notes.js', async: true },
      
      
      
      
  ],

  

});</script><!-- this currently shows up at the wrong location in the final index.html which means the style font is not properly applied-->

<div class="footer">
</div></body></html>